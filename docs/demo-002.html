<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OnePromptOS - Live Search</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}body{font-family:system-ui,sans-serif;height:100vh;overflow:hidden;background:linear-gradient(135deg,#f5f7fa,#dbeafe)}.shell{height:100vh;display:flex;flex-direction:column}.prompt-bar{background:#fff;border-bottom:1px solid #e5e7eb;padding:1rem}.controls{display:flex;gap:.5rem;margin-bottom:.5rem}.btn{padding:.5rem 1rem;border:none;border-radius:.5rem;cursor:pointer;background:#f3f4f6;transition:all .2s}.btn:hover:not(:disabled){background:#e5e7eb}.btn:disabled{opacity:.3;cursor:not-allowed}.btn-primary{background:#3b82f6;color:#fff}.btn-primary:hover:not(:disabled){background:#2563eb}.input-row{display:flex;gap:.5rem}.input{flex:1;padding:.75rem;border:1px solid #d1d5db;border-radius:.5rem;outline:none}.input:focus{border-color:#3b82f6;box-shadow:0 0 0 3px rgba(59,130,246,.1)}.canvas{flex:1;overflow-y:auto;border:4px solid #e5e7eb;transition:border-color .3s}.canvas.dangerous{border-color:#ef4444;background:#fef2f2}.canvas-content{max-width:64rem;margin:0 auto;padding:2rem}.welcome{text-align:center}.title{font-size:2.5rem;font-weight:bold;background:linear-gradient(135deg,#3b82f6,#8b5cf6);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:1rem}.subtitle{font-size:1.25rem;color:#6b7280;margin-bottom:2rem}.features{max-width:32rem;margin:0 auto;text-align:left}.feature{display:flex;gap:1rem;margin-bottom:1rem;color:#374151}.todo-item{display:flex;align-items:center;gap:1rem;padding:1rem;background:#fff;border:1px solid #e5e7eb;border-radius:.5rem;margin-bottom:.5rem;cursor:pointer;transition:all .2s}.todo-item:hover{border-color:#3b82f6}.checkbox{width:1.25rem;height:1.25rem;border:2px solid #d1d5db;border-radius:.25rem;display:flex;align-items:center;justify-content:center}.checkbox.checked{background:#3b82f6;border-color:#3b82f6;color:#fff;font-size:.75rem}.done{text-decoration:line-through;color:#9ca3af}.message{padding:.75rem;background:#dcfce7;color:#166534;border-radius:.5rem;margin-bottom:1rem}.empty{text-align:center;padding:3rem;color:#9ca3af;font-size:1.5rem}.question{text-align:center;padding:2rem}.emoji{font-size:4rem;margin-bottom:1rem}.action-strip{background:#fff;border-top:1px solid #e5e7eb;padding:1rem}.info{font-size:.875rem;color:#6b7280;margin-bottom:.5rem;display:flex;justify-content:space-between;align-items:center}.chips{display:flex;gap:.5rem;flex-wrap:wrap}.chip{padding:.5rem 1rem;border:none;border-radius:.5rem;cursor:pointer;transition:all .2s;font-weight:500}.chip.primary{background:#3b82f6;color:#fff}.chip.primary:hover{background:#2563eb}.chip.danger{background:#ef4444;color:#fff}.chip.danger:hover{background:#dc2626}.chip.neutral{background:#e5e7eb;color:#374151}.chip.neutral:hover{background:#d1d5db}.search-result{background:#fff;padding:1rem;border:1px solid #e5e7eb;border-radius:.5rem;margin-bottom:.75rem;transition:all .2s}.search-result:hover{border-color:#3b82f6;box-shadow:0 2px 8px rgba(0,0,0,.1)}.search-title{font-weight:600;color:#1f2937;margin-bottom:.25rem;font-size:1.1rem}.search-url{color:#3b82f6;font-size:.875rem;margin-bottom:.5rem;word-break:break-all}.search-desc{color:#6b7280;line-height:1.5}.loading{display:flex;align-items:center;justify-content:center;gap:.5rem;color:#6b7280;font-size:1.1rem;padding:3rem}.spinner{animation:spin 1s linear infinite;font-size:1.5rem}@keyframes spin{to{transform:rotate(360deg)}}.mcp-badge{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .5rem;background:#dbeafe;color:#1e40af;border-radius:.25rem;font-size:.75rem;font-weight:600}.live-badge{background:#dcfce7;color:#166534}.error-box{background:#fef2f2;color:#991b1b;padding:1rem;border-radius:.5rem;border:1px solid #fecaca}
    </style>
</head>
<body>
    <div class="shell" id="app"></div>
    <script>
        class SearchAPI{async search(query){try{const res=await fetch(`https://api.duckduckgo.com/?q=${encodeURIComponent(query)}&format=json&no_html=1&skip_disambig=1`);const data=await res.json();const results=[];if(data.AbstractText){results.push({title:data.Heading||query,url:data.AbstractURL||'https://duckduckgo.com/?q='+encodeURIComponent(query),desc:data.AbstractText,source:data.AbstractSource||'DuckDuckGo'})}if(data.RelatedTopics&&data.RelatedTopics.length>0){data.RelatedTopics.slice(0,5).forEach(topic=>{if(topic.Text&&topic.FirstURL){results.push({title:topic.Text.split(' - ')[0]||topic.Text.substring(0,80),url:topic.FirstURL,desc:topic.Text,source:'DuckDuckGo'})}})}if(results.length===0){const wikiRes=await fetch(`https://en.wikipedia.org/w/api.php?action=opensearch&search=${encodeURIComponent(query)}&limit=5&format=json&origin=*`);const wikiData=await wikiRes.json();if(wikiData[1]&&wikiData[1].length>0){for(let i=0;i<wikiData[1].length;i++){results.push({title:wikiData[1][i],url:wikiData[3][i],desc:wikiData[2][i]||'Wikipedia article',source:'Wikipedia'})}}}if(results.length===0){results.push({title:`Search results for "${query}"`,url:`https://duckduckgo.com/?q=${encodeURIComponent(query)}`,desc:'No instant answers found. Click to search on DuckDuckGo for more results.',source:'DuckDuckGo'})}return results}catch(err){console.error('Search error:',err);return[{title:'Search Error',url:'',desc:`Unable to fetch results: ${err.message}. Please check your internet connection.`,source:'Error'}]}}}const searchAPI=new SearchAPI();class Orchestrator{constructor(){this.history=[];this.idx=-1;this.todos=[{id:'1',text:'Learn OnePromptOS',done:false},{id:'2',text:'Build a capability',done:false}];this.add(this.root())}add(m){this.history=this.history.slice(0,this.idx+1);this.history.push(m);this.idx++}root(){return{id:`m${Date.now()}`,focus:{breadcrumb:['Home']},canvas:{r:'welcome',d:{title:'OnePromptOS - Live Search',subtitle:'No forms. No pages. Only Prompt + Pixels + Actions.',features:['Try: "search for React hooks"','Or: "Einstein" for instant answers','Or: "Python tutorial" for Wikipedia results','Real-time web search - no API key needed']}},actions:[{l:'Show Todos',id:'show',t:'SAFE',v:'primary'},{l:'Search Demo',id:'search_demo',t:'SAFE',v:'primary'},{l:'Help',id:'help',t:'SAFE',v:'neutral'}],summary:'Welcome to OnePromptOS',risk:'SAFE',audit:'Initial state'}}async prompt(txt){const l=txt.toLowerCase();if(l.startsWith('search')||l.includes('find')||l.includes('look up')||(!l.includes('todo')&&!l.includes('task')&&!l.includes('help')&&!l.includes('add')&&!l.includes('clear')&&txt.trim().length>3)){const query=txt.replace(/^search\s+(for\s+)?/i,'').trim();return this.action('search',{query})}if(l.includes('todo')||l.includes('task'))return this.action('show');if(l.includes('add'))return this.action('add');if(l.includes('help'))return this.action('help');if(l.includes('clear'))return this.action('clear');const m={id:`m${Date.now()}`,focus:{breadcrumb:['Home']},canvas:{r:'text',d:{msg:`I heard: "${txt}"`,hint:'Try: "search for [topic]" or "show todos"'}},actions:[{l:'Search Demo',id:'search_demo',t:'SAFE',v:'primary'},{l:'Show Todos',id:'show',t:'SAFE',v:'primary'},{l:'Back',id:'back',t:'SAFE',v:'neutral'}],summary:'Processing',risk:'SAFE',audit:`User: ${txt}`};this.add(m);return{next:m}}async action(id,args={}){let m;switch(id){case'search':const query=args.query||'OnePromptOS';m={id:`m${Date.now()}`,focus:{breadcrumb:['Home','Search',query]},canvas:{r:'loading',d:{query}},actions:[{l:'New Search',id:'search_demo',t:'SAFE',v:'primary'},{l:'Back',id:'back',t:'SAFE',v:'neutral'}],summary:'Searching web...',risk:'SAFE',audit:`Searching: ${query}`};this.add(m);render();setTimeout(async()=>{try{const results=await searchAPI.search(query);const resultMoment={id:`m${Date.now()}`,focus:{breadcrumb:['Home','Search',query]},canvas:{r:'search_results',d:{query,results,count:results.length}},actions:[{l:'New Search',id:'search_demo',t:'SAFE',v:'primary'},{l:'Back',id:'back',t:'SAFE',v:'neutral'}],summary:`Found ${results.length} results`,risk:'SAFE',audit:`Search complete: ${query}`};this.add(resultMoment);curr=resultMoment;render()}catch(err){const errorMoment={id:`m${Date.now()}`,focus:{breadcrumb:['Home','Search','Error']},canvas:{r:'error',d:{msg:'Search failed',error:err.message}},actions:[{l:'Try Again',id:'search_demo',t:'SAFE',v:'primary'},{l:'Back',id:'back',t:'SAFE',v:'neutral'}],summary:'Search error',risk:'SAFE',audit:'Search error'};this.add(errorMoment);curr=errorMoment;render()}},300);return{next:m};case'search_demo':m={id:`m${Date.now()}`,focus:{breadcrumb:['Home','Search']},canvas:{r:'search_prompt',d:{examples:['Albert Einstein','Python programming','React hooks','Climate change','Quantum physics']}},actions:[{l:'Einstein',id:'search',args:{query:'Albert Einstein'},t:'SAFE',v:'primary'},{l:'Python Tutorial',id:'search',args:{query:'Python programming'},t:'SAFE',v:'primary'},{l:'React Hooks',id:'search',args:{query:'React hooks'},t:'SAFE',v:'primary'},{l:'Back',id:'back',t:'SAFE',v:'neutral'}],summary:'What would you like to search?',risk:'SAFE',audit:'Search examples'};break;case'show':m={id:`m${Date.now()}`,focus:{task:'todos',breadcrumb:['Home','Todos']},canvas:{r:'todos',d:{todos:this.todos,total:this.todos.length,done:this.todos.filter(t=>t.done).length}},actions:[{l:'Add',id:'add',t:'SAFE',v:'primary'},{l:'Clear',id:'clear',t:'DANGEROUS',v:'danger'},{l:'Back',id:'back',t:'SAFE',v:'neutral'}],summary:`${this.todos.length} tasks`,risk:'SAFE',audit:'View todos'};break;case'add':m={id:`m${Date.now()}`,focus:{task:'add',breadcrumb:['Home','Todos','Add']},canvas:{r:'question',d:{q:'What task?',hint:'Type in prompt bar'}},actions:[{l:'Cancel',id:'show',t:'SAFE',v:'neutral'}],summary:'Adding',risk:'SAFE',audit:'Await input'};break;case'submit':this.todos.push({id:`${Date.now()}`,text:args.text,done:false});m={id:`m${Date.now()}`,focus:{task:'todos',breadcrumb:['Home','Todos']},canvas:{r:'todos',d:{todos:this.todos,total:this.todos.length,done:this.todos.filter(t=>t.done).length,msg:`Added: "${args.text}"`}},actions:[{l:'Add',id:'add',t:'SAFE',v:'primary'},{l:'Back',id:'back',t:'SAFE',v:'neutral'}],summary:`${this.todos.length} tasks`,risk:'SAFE',audit:`Added: ${args.text}`};break;case'toggle':const t=this.todos.find(x=>x.id===args.id);if(t)t.done=!t.done;m={id:`m${Date.now()}`,focus:{task:'todos',breadcrumb:['Home','Todos']},canvas:{r:'todos',d:{todos:this.todos,total:this.todos.length,done:this.todos.filter(t=>t.done).length}},actions:[{l:'Add',id:'add',t:'SAFE',v:'primary'},{l:'Clear',id:'clear',t:'DANGEROUS',v:'danger'},{l:'Back',id:'back',t:'SAFE',v:'neutral'}],summary:`${this.todos.length} tasks`,risk:'SAFE',audit:'Toggle'};break;case'clear':m={id:`m${Date.now()}`,focus:{breadcrumb:['Home','Todos','Confirm']},canvas:{r:'confirm',d:{title:'‚ö†Ô∏è Dangerous',msg:`Delete ${this.todos.length} tasks?`,warn:'Cannot undo'}},actions:[{l:'Yes, Delete',id:'confirmclear',t:'DANGEROUS',v:'danger'},{l:'Cancel',id:'show',t:'SAFE',v:'neutral'}],summary:'Confirm',risk:'DANGEROUS',audit:'Confirm delete'};break;case'confirmclear':this.todos=[];m={id:`m${Date.now()}`,focus:{task:'todos',breadcrumb:['Home','Todos']},canvas:{r:'todos',d:{todos:[],total:0,done:0,msg:'Deleted all'}},actions:[{l:'Add',id:'add',t:'SAFE',v:'primary'},{l:'Back',id:'back',t:'SAFE',v:'neutral'}],summary:'Empty',risk:'SAFE',audit:'Deleted'};break;case'help':m={id:`m${Date.now()}`,focus:{breadcrumb:['Home','Help']},canvas:{r:'help',d:{cmds:[{c:'search for [topic]',d:'Live web search'},{c:'[any question]',d:'Smart search detection'},{c:'show todos',d:'View tasks'},{c:'add task',d:'New task'}]}},actions:[{l:'Search Demo',id:'search_demo',t:'SAFE',v:'primary'},{l:'Show Todos',id:'show',t:'SAFE',v:'primary'},{l:'Back',id:'back',t:'SAFE',v:'neutral'}],summary:'Help',risk:'SAFE',audit:'Help'};break;case'back':return{next:this.back()};default:m=this.root()}this.add(m);return{next:m}}get(){return this.history[this.idx]}back(){if(this.idx>0){this.idx--;return this.history[this.idx]}return null}canBack(){return this.idx>0}redo(){if(this.idx<this.history.length-1){this.idx++;return this.history[this.idx]}return null}canFwd(){return this.idx<this.history.length-1}home(){const r=this.root();this.add(r);return r}}const orc=new Orchestrator();let curr=orc.get();let proc=false;function renderCanvas(m){const{r,d}=m.canvas;switch(r){case'welcome':return`<div class="welcome"><div class="title">${d.title}</div><div class="subtitle">${d.subtitle}</div><div class="features">${d.features.map((f,i)=>`<div class="feature"><b>${i+1}.</b><span>${f}</span></div>`).join('')}</div></div>`;case'search_prompt':return`<div class="question"><div class="emoji">üîç</div><h2>What would you like to search?</h2><p style="color:#6b7280;margin:1rem 0">Type your query in the prompt bar or try these:</p><div style="max-width:32rem;margin:0 auto;text-align:left">${d.examples.map(ex=>`<div style="padding:.5rem 1rem;background:#f9fafb;border-radius:.5rem;margin:.5rem 0;color:#374151">"${ex}"</div>`).join('')}</div></div>`;case'loading':return`<div class="loading"><span class="spinner">‚ü≥</span><span>Searching for "${d.query}"...</span></div>`;case'search_results':return`<div><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem;flex-wrap:wrap;gap:.5rem"><h2 style="margin:0">Search: ${d.query}</h2><span class="mcp-badge live-badge">‚úì LIVE RESULTS</span></div><div style="color:#6b7280;margin-bottom:1rem">Found ${d.count} result${d.count!==1?'s':''}</div>${d.results.map(r=>`<div class="search-result"><div class="search-title">${r.title}</div><div class="search-url">${r.url||'N/A'}</div><div class="search-desc">${r.desc}</div><div style="margin-top:.5rem;font-size:.75rem;color:#9ca3af">Source: ${r.source||'Web'}</div></div>`).join('')}</div>`;case'error':return`<div class="question"><div class="emoji">‚ùå</div><div class="error-box"><h3 style="margin-bottom:.5rem">${d.msg}</h3><p>${d.error}</p></div></div>`;case'todos':return`<h2>Todos (${d.done}/${d.total})</h2>${d.msg?`<div class="message">‚úì ${d.msg}</div>`:''}${d.todos.length?d.todos.map(t=>`<div class="todo-item" onclick="handleToggle('${t.id}')"><div class="checkbox ${t.done?'checked':''}">${t.done?'‚úì':''}</div><span class="${t.done?'done':''}">${t.text}</span></div>`).join(''):'<div class="empty">üìù<br>No tasks</div>'}`;case'question':return`<div class="question"><div class="emoji">üí≠</div><h2>${d.q}</h2><p style="color:#6b7280">${d.hint}</p></div>`;case'confirm':return`<div class="question"><div class="emoji">‚ö†Ô∏è</div><h2>${d.title}</h2><p>${d.msg}</p><p style="color:#dc2626;font-weight:600">${d.warn}</p></div>`;case'help':return`<h2>Help</h2><div style="margin-top:1rem">${d.cmds.map(c=>`<div style="padding:.5rem;background:#f9fafb;margin-bottom:.5rem"><code style="color:#3b82f6">${c.c}</code> - ${c.d}</div>`).join('')}</div><div style="margin-top:1.5rem;padding:1rem;background:#dcfce7;border-radius:.5rem;color:#166534"><b>‚úì LIVE SEARCH ENABLED</b><br>This demo uses real DuckDuckGo Instant Answers API and Wikipedia. No API keys needed!</div>`;case'text':return`<div class="question"><p style="font-size:1.25rem">${d.msg}</p><p style="color:#6b7280">${d.hint||''}</p></div>`;default:return'<div class="question">Unknown</div>'}}function render(){const risk=curr.risk==='DANGEROUS'?'dangerous':'';document.getElementById('app').innerHTML=`<div class="prompt-bar"><div class="controls"><button class="btn" onclick="handleBack()" ${!orc.canBack()?'disabled':''}>‚óÄ</button><button class="btn" onclick="handleHome()">‚åÇ</button><button class="btn" onclick="handleUndo()" ${!orc.canBack()?'disabled':''}>‚Ü∂</button><button class="btn" onclick="handleRedo()" ${!orc.canFwd()?'disabled':''}>‚Ü∑</button><span style="margin-left:auto;font-size:.875rem;color:#6b7280">${curr.focus.breadcrumb.join(' ‚Ä∫ ')}</span></div><div class="input-row"><input type="text" class="input" id="inp" placeholder='Try: "Einstein" or "Python tutorial"' ${proc?'disabled':''}><button class="btn btn-primary" onclick="handleSubmit()" ${proc?'disabled':''}>Search</button></div></div><div class="canvas ${risk}"><div class="canvas-content">${renderCanvas(curr)}</div></div><div class="action-strip"><div class="info"><span>${curr.summary}</span><span class="mcp-badge live-badge" style="font-size:.7rem">‚úì LIVE</span></div><div class="chips">${curr.actions.map((a,i)=>`<button class="chip ${a.v}" onclick='handleAction(${JSON.stringify(a.id)},${JSON.stringify(a.args||{})})' ${proc?'disabled':''}>${a.l}</button>`).join('')}</div></div>`;const inp=document.getElementById('inp');if(inp){inp.addEventListener('keydown',e=>{if(e.key==='Enter')handleSubmit()});inp.focus()}}async function handleSubmit(){const inp=document.getElementById('inp');if(!inp||!inp.value.trim()||proc)return;proc=true;const val=inp.value;const focus=curr.focus;if(focus.task==='add'){const res=await orc.action('submit',{text:val});if(res.next)curr=res.next}else{const res=await orc.prompt(val);if(res.next)curr=res.next}proc=false;render()}async function handleAction(id,args){if(proc)return;proc=true;const res=await orc.action(id,args);if(res.next)curr=res.next;proc=false;render()}function handleToggle(id){handleAction('toggle',{id})}async function handleBack(){const p=orc.back();if(p){curr=p;render()}}async function handleUndo(){const p=orc.back();if(p){curr=p;render()}}async function handleRedo(){const n=orc.redo();if(n){curr=n;render()}}async function handleHome(){curr=orc.home();render()}render();
    </script>
</body>
</html>
